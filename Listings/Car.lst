C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE CAR
OBJECT MODULE PLACED IN .\Objects\Car.obj
COMPILER INVOKED BY: E:\keil\C51\BIN\C51.EXE Car.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\Ca
                    -r.lst) OBJECT(.\Objects\Car.obj)

line level    source

   1          #include <reg52.h>
   2          #include "mouse.h"
   3          
   4          sbit beep = P2 ^ 4;//æ‰¾åˆ°èœ‚é¸£å™¨çš„åœ°å€ä½
   5          bit ir = 0;//æ ‡å¿—ä¸­æ–­æ—¶å‘å°„è¿˜æ˜¯æ¥æ”¶
   6          unsigned char num_G = 0;//æ ‡è®°è¿™æ¬¡å‘å°„çº¢å¤–å…‰çš„LEDç®¡
   7          const unsigned  int code forward[] = { 0x11,0x33,0x22,0x66,0x44,0xcc,0x88,0x99 };//ç”µæœºæ­£è½¬å‘¨æœŸ
   8          const unsigned  int code reverse[] = { 0x11,0x99,0x88,0xcc,0x44,0x66,0x22,0x33 };//ç”µæœºåè½¬å‘¨æœŸ
   9          unsigned char map[8][8];//å®šä¹‰è¿·å®«çš„8*8å°æ–¹æ ¼ é«˜å››ä½è®°å½•è¿›å…¥è¿·å®«å°æ–¹æ ¼çš„æ–¹å‘ ä½å››
             -ä½è®°å½•è¿·å®«å°æ–¹æ ¼çš„æŒ¡æ¿æƒ…å†µ
  10          unsigned char i, j;//å¾ªç¯ä½“å˜é‡
  11          unsigned char CarTurn_Dir = 0;//å®šä¹‰å°è½¦çš„è½¬åŠ¨æ–¹å‘
  12          unsigned char CarReal_Dir = 0;//å®šä¹‰å°è½¦çš„ç»å¯¹æ–¹å‘
  13          unsigned char num_StackNow = 0;//è®°å½•å°è½¦åœ¨å»ºç«‹åœ°å›¾çš„ç­‰é«˜è¡¨æ—¶æ‰€ç¡®å®šçš„é˜Ÿçš„ç›®å‰ä½ç½®
  14          unsigned char num_Stack = 0;//è®°å½•æ ˆä¸­åæ ‡çš„ä¸ªæ•°
  15          unsigned char stackX[64], stackY[64];//ä½¿ç”¨æ•°ç»„æ¨¡æ‹Ÿæ ˆçš„æ•ˆæœï¼ŒstackXè®°å½•å²”è·¯å£çš„xåæ ‡,st
             -ackYè®°å½•å²”è·¯å£çš„yåæ ‡
  16          unsigned char mapFlag[8][8];//æ¯ä¸ªè¿·å®«éƒ½æœ‰ä¸€ä¸ªå˜é‡æ¥è®°å½•è¿·å®«æ–¹æ ¼çš„çŠ¶æ€ï¼š0æœªèµ°è¿‡ 1è
             -µ°è¿‡
  17          unsigned char dirNum = 0; //è®°å½•æ¯ä¸ªè¿·å®«æ–¹æ ¼å‘¨å›´å¯ä»¥åŒè¡Œçš„æ–¹å‘çš„æ•°é‡ï¼Œæ¥åˆ¤æ–­è¿™ä¸ª
             -è¿·å®«æ–¹æ ¼æ˜¯å¦æ˜¯å²”è·¯å£
  18          
  19          void InitMap();//è¿·å®«æ–¹æ ¼çš„åˆå§‹åŒ–å‡½æ•°
  20          void InitMapFlag();//è¿·å®«æ–¹æ ¼æ ‡è®°çš„åˆå§‹åŒ–å‡½æ•°
  21          void InitStack();//è¿·å®«æ•°ç»„ï¼ˆæ ˆã€é˜Ÿåˆ—ï¼‰çš„åˆå§‹åŒ–
  22          void InitTime2();//å®šæ—¶å™¨T2åˆå§‹åŒ–
  23          void JudgeMap_byRed();//é€šè¿‡çº¢å¤–çº¿æ£€æµ‹è¿·å®«æ–¹æ ¼å‘¨å›´çš„æŒ¡æ¿æƒ…å†µï¼Œå¹¶è®°å½•åˆ°map[][]çš„ä½
             -å››ä½ä¸­
  24          void JudgeMap_byDir();//é€šè¿‡å°è½¦çš„ç»å¯¹æ–¹å‘æ¥èµ‹ç»™ä¸‹ä¸€ä¸ªä½ç½®çš„é€šè¿‡è¿·å®«å°æ–¹æ ¼æ–¹å‘ï
             -¼Œå¹¶è®°å½•åˆ°map[][]çš„é«˜å››ä½ä¸­
  25          void WorkForFork();//å¯¹æ²¡æœ‰èµ°è¿‡çš„å²”è·¯å£ä½œå‡ºç›¸åº”çš„å¤„ç†
  26          void SearchMode0();//å³æ‰‹æ³•åˆ™
  27          void SearchMode1();//å·¦æ‰‹æ³•åˆ™
  28          void SearchMode2();//ä¸­å·¦æ³•åˆ™
  29          void SearchMode3();//ä¸­å³æ³•åˆ™
  30          void DrawHeightMap();//ç”»å‡ºåœ°å›¾çš„ç­‰é«˜å›¾
  31          void MakeRushMap();//åˆ¶ä½œå†²åˆºè·¯çº¿
  32          void CarRush();//å°è½¦çš„æœ€åå†²åˆº
  33          void WorkForEnd();//å¯¹å°è½¦å¤„åœ¨æ­»èƒ¡åŒæˆ–è€…ç»ˆç‚¹ï¼ˆæ²¡æœ‰éå†å®Œåœ°å›¾ï¼‰åšå‡ºç›¸åº”çš„å¤„ç†
  34          char CarRegional();//åˆ¤æ–­å°è½¦æ‰€åœ¨çš„ä½ç½®åŒºåŸŸ
  35          
  36          void Delay_ms(int time);//å»¶æ—¶å‡½æ•°
  37          void Search_Mode(int data_car);//æœ€ç»ˆçš„å°è½¦çš„è¡Œèµ°ç­–ç•¥
  38          void DriveCar(int Dir);//é©±åŠ¨å°è½¦å‡½æ•°
  39          void PostureFix(int Dir);//å°è½¦çš„å§¿åŠ¿ä¿®å¤
  40          void GetReal_Dir(int Dir);//è·å–å°è½¦çš„ç»å¯¹æ–¹å‘
  41          void GetReal_Pos(int Dir);//è·å–å°è½¦çš„ä½ç½®
  42          void PlaySound(int time);//èœ‚é¸£å™¨å‘å£°
  43          void SetTime2(unsigned int);//è®¾ç½®T2è‡ªåŠ¨é‡è½½å¯„å­˜å™¨å’Œè®¡æ•°å™¨åˆå€¼
  44          
  45          struct mouseCar
  46          {
  47                  unsigned int x; 
  48                  unsigned int y;
C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 2   

  49          };//å®šä¹‰å°è½¦çš„ç»“æ„ä½“
  50          struct mouseCar Car = {0,0};//å®šä¹‰å°è½¦çš„å•ä¾‹
  51          //ä¸»å‡½æ•°
  52          void main()
  53          {
  54   1              InitTime2();
  55   1              InitMap();
  56   1              InitMapFlag();
  57   1              InitStack();
  58   1              //åŠŸèƒ½1ï¼šä»æŒ‡å®šèµ·ç‚¹å¼€å§‹åœ¨è¿·å®«ä¸­è¡Œèµ°ï¼Œæ‰¾åˆ°æŒ‡å®šç»ˆç‚¹
  59   1              while (!(Car.x == 7 && Car.y == 7))
  60   1              {
  61   2                       /*
  62   2                       * åˆ¤æ–­å°è½¦æ‰€åœ¨ä½ç½®ä»¥åŠæ‰€åœ¨ä½ç½®çš„çš„æŒ¡æ¿æƒ…å†µ
  63   2                       * å¦‚æœå°è½¦æ‰€åœ¨çš„ä½ç½®æ˜¯å²”è·¯å£ï¼Œåˆ™å°†å²”è·¯å£å‹å…¥æ ˆ
  64   2                       * å¦‚æœå°è½¦æ‰€åœ¨çš„ä½ç½®æ˜¯ç»ˆç‚¹ï¼ˆæœªéå†å®Œæ‰€æœ‰è·¯çº¿ï¼‰æˆ–è€…æ­»èƒ¡åŒï¼Œåˆ™å°è½¦å°†å›åˆ
             -°æœ€è¿‘çš„å²”è·¯å£ä»æ–°å¼€å§‹è¡Œèµ°
  65   2                       * å¦‚æœå°è½¦æ‰€åœ¨çš„ä½ç½®æ—¢ä¸æ˜¯å²”è·¯å£ï¼Œä¹Ÿä¸æ˜¯æ­»èƒ¡åŒæˆ–è€…ç»ˆç‚¹ï¼Œé‚£ä¹ˆç›´æ¥æŒ‰ç…§å¯
             -»è·¯ç­–ç•¥é©±åŠ¨å°è½¦è¡Œèµ°
  66   2                       */
  67   2                      
  68   2                      if (dirNum > 1 && mapFlag[Car.x][Car.y] == 0)
  69   2                              WorkForFork();
  70   2                      else  if (dirNum == 0 || ((Car.x == 7 && Car.y == 7) && num_Stack != 0))
  71   2                              WorkForEnd();
  72   2                      mapFlag[Car.x][Car.y] = 1;//å°†å½“å‰å°è½¦æ‰€å¤„åœ¨çš„è¿·å®«æ–¹æ ¼æ ‡è®°ä¸º1
  73   2                      DriveCar(CarTurn_Dir);//é©±åŠ¨å°è½¦è¡Œèµ°
  74   2              }
  75   1              //åŠŸèƒ½2ï¼šå°è½¦ä»ç»ˆç‚¹å¼€å§‹éå†è¿·å®«è¿”å›èµ·ç‚¹ï¼Œå¯»æ‰¾æœ€çŸ­è·¯å¾„
  76   1              InitMap();
  77   1              InitMapFlag();
  78   1              InitStack();
  79   1              num_Stack = 0;
  80   1              while (!(Car.x == 0 && Car.x == 0 && num_Stack == 0))
  81   1              {
  82   2                      JudgeMap_byDir();
  83   2                      JudgeMap_byRed();
  84   2                      Search_Mode(CarRegional());//æŒ‰ç…§åˆ¶è®¢å¥½çš„å¯»è·¯ç­–ç•¥æ¥ç¡®å®šå°è½¦çš„è¡Œèµ°æ–¹å‘
  85   2                      GetReal_Dir(CarTurn_Dir);//è·å–å°è½¦çš„ç»å¯¹è¡Œèµ°æ–¹å‘
  86   2                      GetReal_Pos(CarReal_Dir);//è·å–å°è½¦çš„ç»å¯¹ä½ç½®
  87   2                      JudgeMap_byRed();
  88   2                      if (dirNum > 1 && mapFlag[Car.x][Car.y] == 0)
  89   2                              WorkForFork();
  90   2                      else  if (dirNum == 0 || ((Car.x == 7 && Car.y == 7) && num_Stack != 0))
  91   2                              WorkForEnd();
  92   2                      mapFlag[Car.x][Car.y] = 1;//å°†å½“å‰å°è½¦æ‰€å¤„åœ¨çš„è¿·å®«æ–¹æ ¼æ ‡è®°ä¸º1
  93   2                      DriveCar(CarTurn_Dir);//é©±åŠ¨å°è½¦è¡Œèµ°
  94   2              }
  95   1              //åŠŸèƒ½3ï¼šæ ¹æ®æœ€çŸ­è·¯å¾„å†²åˆºåˆ°ç»ˆç‚¹
  96   1      
  97   1              /*å°†åœ°å›¾çš„åŒä¸€é«˜åº¦çš„åœ°å›¾æ–¹å—è¿›é˜Ÿï¼Œåæ ‡å­˜è´®åˆ°é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æœç´¢æ—¶å‡ºé
             -˜Ÿ
  98   1              * å¦‚æœåŒä¸€é«˜åº¦çš„èŠ‚ç‚¹å…¨éƒ¨è¿›é˜Ÿï¼Œé‚£ä¹ˆä¸‹æ¬¡å…¥é˜Ÿçš„åœ°å›¾æ–¹å—é«˜åº¦æ•°åŠ ä¸€
  99   1              * æ ‡è®°è¿›é˜Ÿçš„åœ°å›¾æ–¹å—ï¼Œä¸‹æ¬¡æœç´¢åˆ°è¯¥æ–¹å—æ—¶é«˜åº¦æ•°ä¸æ”¹å˜
 100   1              * å¦‚æœæ‰¾åˆ°èµ·ç‚¹ï¼Œé‚£ä¹ˆç»ˆæ­¢æœç´¢ï¼Œç”»å‡ºç­‰é«˜è¡¨
 101   1              */
 102   1      
 103   1              DrawHeightMap();
 104   1      
 105   1              /*
 106   1              * åˆ©ç”¨ç­‰é«˜è¡¨ï¼Œä»èµ·ç‚¹å‡ºå‘ï¼Œæ¯æ¬¡æ‰¾æ¯”ä¸Šä¸€ä¸ªåœ°å›¾æ–¹å—é«˜åº¦æ•°å°ä¸€çš„çš„åœ°å›¾æ–¹å—
 107   1              * è®°å½•å†²åˆºçš„çš„æ¯ä¸ªåœ°å›¾æ–¹å—çš„æ–¹å‘ï¼Œè®°å½•åˆ°æ•°ç»„ä¸­
C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 3   

 108   1              * å°è½¦å†²åˆºåˆ°ç»ˆç‚¹
 109   1              * 
 110   1              */
 111   1      
 112   1              MakeRushMap();
 113   1              CarRush();
 114   1      
 115   1      
 116   1              //åŠŸèƒ½3ï¼šå°è½¦å›åˆ°èµ·ç‚¹åèœ‚é¸£å™¨å‘å‡ºå£°éŸ³
 117   1              PlaySound(10);
 118   1              while (1);//æ— é™å¾ªç¯ï¼Œé˜²æ­¢å•ç‰‡æœºè·‘é£
 119   1      }
 120          //å»¶æ—¶å‡½æ•°
 121          void Delay_ms(int time)
 122          {
 123   1              for (i = time; i > 0; i--)
 124   1                      for (j = 0; j < 100; j++);
 125   1      }
 126          //åˆå§‹åŒ–åœ°å›¾
 127          void InitMap()
 128          {
 129   1              for(i = 0; i < 8; i ++)
 130   1                      for (j = 0; j < 8; j++)
 131   1                      {
 132   2                              map[i][j] = 0xff;
 133   2                      }
 134   1      }
 135          //åˆå§‹åŒ–åœ°å›¾æ ‡è®°
 136          void InitMapFlag()
 137          {
 138   1              for(i = 0; i < 8; i++)
 139   1                      for (j = 0; j < 8; j++)
 140   1                      {
 141   2                              mapFlag[i][j] = 0;
 142   2                      }
 143   1      }
 144          //åˆå§‹åŒ–æ ˆã€é˜Ÿåˆ—
 145          void InitStack()
 146          {
 147   1              for (i = 0; i < 64; i++)
 148   1              {
 149   2                      stackX[i] = 0;
 150   2                      stackY[i] = 0;
 151   2              }
 152   1      }
 153          //åˆ¤æ–­åœ°å›¾æ–¹æ ¼å‘¨å›´çš„æŒ¡æ¿æƒ…å†µ
 154          void JudgeMap_byRed()
 155          {
 156   1              if (!irC) { dirNum++; map[Car.x][Car.y] = map[Car.x][Car.y] & 0xf7; }//å¦‚æœæ­£å‰æ–¹æ²¡æœ‰æŒ¡æ¿ï¼Œé‚£ä
             -¹ˆæŒ¡æ¿æ•°åŠ ä¸€ï¼Œæ”¹å˜è¿·å®«çš„ä½å››ä½
 157   1              else if (!irR) { dirNum++; map[Car.x][Car.y] = map[Car.x][Car.y] & 0xfb; }//å¦‚æœå³å‰æ–¹æ²¡æœ‰æŒ¡æ¿
 158   1              else if (!irL) { dirNum++; map[Car.x][Car.y] = map[Car.x][Car.y] & 0xfd; }//å¦‚æœå·¦å‰æ–¹æ²¡æœ‰æŒ¡æ¿
 159   1      
 160   1              if (irLU && !irC)
 161   1                      PostureFix(0);
 162   1              else if (irRU && !irC)
 163   1                      PostureFix(1);
 164   1      
 165   1      }
 166          //åˆ¤æ–­åœ°å›¾æ–¹æ ¼çš„é€šè¿‡æ–¹å‘
 167          void JudgeMap_byDir()
 168          {
C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 4   

 169   1              switch (CarTurn_Dir)
 170   1              {
 171   2              case 0:map[Car.x][Car.y + 1] = map[Car.x][Car.y] & 0x7f;
 172   2              case 1:map[Car.x + 1][Car.y] = map[Car.x][Car.y] & 0xbf;
 173   2              case 2:map[Car.x][Car.y - 1] = map[Car.x][Car.y] & 0xdf;
 174   2              case 3:map[Car.x - 1][Car.y] = map[Car.x][Car.y] & 0xef;
 175   2              default:break;
 176   2              }
 177   1      
 178   1      }
 179          //è·å¾—å°è½¦çš„ç»å¯¹æ–¹å‘
 180          void GetReal_Dir(int Dir)
 181          {
 182   1              CarReal_Dir = (CarReal_Dir + Dir) % 4;
 183   1      }
 184          //è·å¾—å°è½¦çš„ä½ç½®
 185          void GetReal_Pos(int Dir)
 186          {
 187   1              switch (Dir)
 188   1              {
 189   2              case 0:Car.y += 1; break;
 190   2              case 1:Car.x += 1; break;
 191   2              case 2:Car.y -= 1; break;
 192   2              case 3:Car.x -= 1; break;
 193   2              default:break;
 194   2              }
 195   1      
 196   1      }
 197          //å¯¹æ²¡æœ‰èµ°è¿‡çš„å²”è·¯å£åšå‡ºç›¸åº”çš„å¤„ç†
 198          void WorkForFork()
 199          {
 200   1              stackX[num_Stack] = Car.x;
 201   1              stackY[num_Stack] = Car.y;//å°†å²”è·¯å£çš„åæ ‡å‹å…¥æ ˆï¼ˆæ•°ç»„ï¼‰ä¸­
 202   1              num_Stack++;//æ ˆçš„é•¿åº¦+1
 203   1      }
 204          //å¯¹æ­»èƒ¡åŒåšå‡ºç›¸åº”çš„å¤„ç†ï¼ˆæœªå®Œæˆå¯¹å›æº¯è·¯å¾„çš„å¤„ç†ï¼‰
 205          void WorkForEnd()
 206          {
 207   1              //å›æº¯åˆ°æœ€è¿‘çš„ä¸€ä¸ªå²”è·¯å£
 208   1              while (!(Car.x == stackX[num_Stack - 1] && Car.y == stackY[num_Stack - 1]))
 209   1              {
 210   2                      switch (map[Car.x][Car.y] / 16)
 211   2                      {
 212   3                              //å‡å¦‚è¿›æ¥æ—¶æœå‰,åˆ™å›å»æ—¶æœå
 213   3                      case 7:CarTurn_Dir = 2; break;
 214   3                              //å‡å¦‚è¿›æ¥æ—¶æœå³ï¼Œåˆ™å›å»æ—¶æœå·¦
 215   3                      case 11:CarTurn_Dir = 3; break;
 216   3                              //å‡å¦‚è¿›æ¥æ—¶æœåï¼Œåˆ™å›å»æ—¶æœå‰
 217   3                      case 13:CarTurn_Dir = 0; break;
 218   3                              //å‡å¦‚è¿›æ¥æ—¶æœå·¦ï¼Œåˆ™å›å»æ—¶æœå³
 219   3                      case 15:CarTurn_Dir = 1; break;
 220   3                      }
 221   2                      DriveCar(CarTurn_Dir);
 222   2              }
 223   1              num_Stack--;//æ ˆçš„é•¿åº¦å‡ä¸€
 224   1      
 225   1      }
 226          //ç”µæœºé©±åŠ¨å‡½æ•°
 227          void DriveCar(int Dir)
 228          {
 229   1              JudgeMap_byDir();//åˆ¤æ–­å°è½¦çš„ç»å¯¹æ–¹å‘
 230   1              JudgeMap_byRed();//åˆ¤æ–­å°è½¦çš„æ‰€åœ¨ä½ç½®çš„æŒ¡æ¿æƒ…å†µ
C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 5   

 231   1              Search_Mode(CarRegional());//æŒ‰ç…§åˆ¶è®¢å¥½çš„å¯»è·¯ç­–ç•¥æ¥ç¡®å®šå°è½¦çš„è¡Œèµ°æ–¹å‘
 232   1              GetReal_Dir(CarTurn_Dir);//è·å–å°è½¦çš„ç»å¯¹è¡Œèµ°æ–¹å‘
 233   1              GetReal_Pos(CarReal_Dir);//è·å–å°è½¦çš„ç»å¯¹ä½ç½®
 234   1              JudgeMap_byRed();
 235   1              //åˆ¤æ–­å°è½¦çš„è¡Œèµ°æ–¹å‘
 236   1              switch (Dir)
 237   1              {
 238   2                      //å¦‚æœå‘å‰èµ°
 239   2              case 0: {
 240   3                      for (j = 0; j < 110; j++)
 241   3                      {
 242   4                              for (i = 0; i < 8; i++)
 243   4                              {
 244   5                                      P1 = forward[i];
 245   5                                      Delay_ms(3);
 246   5                              }
 247   4                      }
 248   3              }break;
 249   2                      //å¦‚æœå‘å³èµ°
 250   2              case 1: {
 251   3                      for (j = 0; j < 55; j++)
 252   3                      {
 253   4                              for (i = 0; i < 8; i++)
 254   4                              {
 255   5                                      P1 = (forward[i] | 0xf0);
 256   5                                      Delay_ms(3);
 257   5                              }
 258   4                      }
 259   3                      for (j = 0; j < 55; j++)
 260   3                      {
 261   4                              for (i = 0; i < 8; i++)
 262   4                              {
 263   5                                      P1 = (reverse[i] | 0x0f);
 264   5                                      Delay_ms(3);
 265   5                                              
 266   5                              }
 267   4                      }
 268   3              }
 269   2                        //å¦‚æœå‘åèµ°
 270   2              case 2: {
 271   3                      for (j = 0; j < 110; j++)
 272   3                      {
 273   4                              for (i = 0; i < 8; i++)
 274   4                              {
 275   5                                      P1 = reverse[i];
 276   5                              }
 277   4                      }
 278   3              }
 279   2                        //å¦‚æœå‘å·¦èµ°
 280   2              case 3: {
 281   3                      for (j = 0; j < 55; j++)
 282   3                      {
 283   4                              for (i = 0; i < 8; i++)
 284   4                              {
 285   5                                      P1 = (reverse[i] | 0xf0);
 286   5                                      Delay_ms(3);
 287   5                              }
 288   4                      }
 289   3                      for (j = 0; j < 55; j++)
 290   3                      {
 291   4                              for (i = 0; i < 8; i++)
 292   4                              {
C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 6   

 293   5                                      P1 = (forward[i] | 0x0f);
 294   5                                      Delay_ms(3);
 295   5      
 296   5                              }
 297   4                      }
 298   3              }
 299   2              default:break;
 300   2              }
 301   1      }
 302          //å°è½¦çš„å§¿åŠ¿ä¿®å¤
 303          void PostureFix(int Dir)
 304          {
 305   1              if (Dir == 0)//å¦‚æœå°è½¦æ–¹å‘å¾€å·¦åç§»ï¼Œé‚£ä¹ˆå°è½¦é€‚å½“å‘å³åè½¬
 306   1              {
 307   2                      while (irLU)
 308   2                              DriveCar(1);
 309   2              }
 310   1              else if(Dir == 1)//å¦‚æœå°è½¦æ–¹å‘å¾€å³åè½¬ï¼Œé‚£ä¹ˆå°è½¦é€‚å½“å‘å·¦åè½¬
 311   1              {
 312   2                      while (irRU)
 313   2                              DriveCar(3);
 314   2              }
 315   1      }
 316          //å³æ‰‹æ³•åˆ™
 317          void SearchMode0()
 318          {
 319   1              //å¦‚æœå¯ä»¥å‘å³è½¬ï¼Œåˆ™å‘å³è½¬
 320   1              if (map[Car.x][Car.y] | 0xfb == 0xfb)
 321   1              {
 322   2                      CarTurn_Dir = 1;
 323   2                      return;
 324   2              }
 325   1      
 326   1              //å¦‚æœå¯ä»¥å‘å‰è½¬ï¼Œåˆ™å‘å‰è½¬
 327   1              else if (map[Car.x][Car.y] | 0xf7 == 0xf7)
 328   1              {
 329   2                      CarTurn_Dir = 0;
 330   2                      return;
 331   2              }
 332   1      
 333   1              //å¦‚æœå¯ä»¥å‘å·¦è½¬ï¼Œåˆ™å‘å·¦è½¬
 334   1              else if (map[Car.x][Car.y] | 0xfe == 0xfe)
 335   1              {
 336   2                      CarTurn_Dir = 3;
 337   2                      return;
 338   2              }
 339   1      
 340   1      }
 341          //å·¦æ‰‹æ³•åˆ™
 342          void SearchMode1()
 343          {
 344   1              //å¦‚æœå¯ä»¥å‘å·¦è½¬ï¼Œåˆ™å‘å·¦è½¬
 345   1              if (map[Car.x][Car.y] | 0xfe == 0xfe)
 346   1              {
 347   2                      CarTurn_Dir = 3;
 348   2                      return;
 349   2              }
 350   1      
 351   1              //å¦‚æœå¯ä»¥å‘å‰è½¬ï¼Œåˆ™å‘å‰è½¬
 352   1              else if (map[Car.x][Car.y] | 0xf7 == 0xf7)
 353   1              {
 354   2                      CarTurn_Dir = 0;
C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 7   

 355   2                      return;
 356   2              }
 357   1      
 358   1              //å¦‚æœå¯ä»¥å‘å³è½¬ï¼Œåˆ™å‘å³è½¬
 359   1              else if (map[Car.x][Car.y] | 0xfb == 0xfb)
 360   1              {
 361   2                      CarTurn_Dir = 1;
 362   2                      return;
 363   2              }
 364   1      
 365   1      }
 366          //ä¸­å·¦æ³•åˆ™
 367          void SearchMode2()
 368          {
 369   1              //å¦‚æœå¯ä»¥å‘å‰è½¬ï¼Œåˆ™å‘å‰è½¬
 370   1              if (map[Car.x][Car.y] | 0xf7 == 0xf7)
 371   1              {
 372   2                      CarTurn_Dir = 0;
 373   2                      return;
 374   2              }
 375   1      
 376   1              //å¦‚æœå¯ä»¥å‘å·¦è½¬ï¼Œåˆ™å‘å·¦è½¬
 377   1              else if (map[Car.x][Car.y] | 0xfe == 0xfe)
 378   1              {
 379   2                      CarTurn_Dir = 3;
 380   2                      return;
 381   2              }
 382   1      
 383   1      
 384   1              //å¦‚æœå¯ä»¥å‘å³è½¬ï¼Œåˆ™å‘å³è½¬
 385   1              else if (map[Car.x][Car.y] | 0xfb == 0xfb)
 386   1              {
 387   2                      CarTurn_Dir = 1;
 388   2                      return;
 389   2              }
 390   1      
 391   1      }
 392          //ä¸­å³æ³•åˆ™
 393          void SearchMode3()
 394          {
 395   1              //å¦‚æœå¯ä»¥å‘å‰è½¬ï¼Œåˆ™å‘å‰è½¬
 396   1              if (map[Car.x][Car.y] | 0xf7 == 0xf7)
 397   1              {
 398   2                      CarTurn_Dir = 0;
 399   2                      return;
 400   2              }
 401   1      
 402   1              //å¦‚æœå¯ä»¥å‘å³è½¬ï¼Œåˆ™å‘å³è½¬
 403   1              else if (map[Car.x][Car.y] | 0xfb == 0xfb)
 404   1              {
 405   2                      CarTurn_Dir = 1;
 406   2                      return;
 407   2              }
 408   1      
 409   1              //å¦‚æœå¯ä»¥å‘å·¦è½¬ï¼Œåˆ™å‘å·¦è½¬
 410   1              else if (map[Car.x][Car.y] | 0xfe == 0xfe)
 411   1              {
 412   2                      CarTurn_Dir = 3;
 413   2                      return;
 414   2              }
 415   1      }
 416          //åˆ¤æ–­å°è½¦æ‰€åœ¨çš„ä½ç½®åŒºåŸŸ
C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 8   

 417          char CarRegional()
 418          {
 419   1              if (Car.x <= 3 && Car.y <= 3)
 420   1                      return 0;
 421   1              else if (Car.x >= 3 && Car.y > 3)
 422   1                      return 1;
 423   1              else if (Car.x <= 3 && Car.y > 3)
 424   1                      return 2;
 425   1              else 
 426   1                      return 3;
 427   1      }
 428          //æœ€ç»ˆçš„è¡Œèµ°ç­–ç•¥
 429          void Search_Mode(int Data)
 430          {
 431   1              switch (Data)
 432   1              {
 433   2              case 0: {
 434   3                      if (CarReal_Dir == 0) SearchMode3();
 435   3                      else if (CarReal_Dir == 1) SearchMode2();
 436   3                      else if (CarReal_Dir == 2) SearchMode0();
 437   3                      else if (CarReal_Dir == 3) SearchMode1();
 438   3              }break;
 439   2              case 1: {
 440   3                      if (CarReal_Dir == 0) SearchMode2();
 441   3                      else if (CarReal_Dir == 1) SearchMode1();
 442   3                      else if (CarReal_Dir == 2) SearchMode3();
 443   3                      else if (CarReal_Dir == 3) SearchMode0();
 444   3              }break;
 445   2              case 2: {
 446   3                      if (CarReal_Dir == 0) SearchMode1();
 447   3                      else if (CarReal_Dir == 1) SearchMode0();
 448   3                      else if (CarReal_Dir == 2) SearchMode2();
 449   3                      else if (CarReal_Dir == 3) SearchMode3();
 450   3              }break;
 451   2              case 3: {
 452   3                      if (CarReal_Dir == 0) SearchMode0();
 453   3                      else if (CarReal_Dir == 1) SearchMode3();
 454   3                      else if (CarReal_Dir == 2) SearchMode1();
 455   3                      else if (CarReal_Dir == 3) SearchMode2();
 456   3              }break;
 457   2              default:break;
 458   2              }
 459   1      
 460   1      }
 461          //èœ‚é¸£å™¨å‘å‡ºå£°éŸ³
 462          void PlaySound(int time)
 463          {
 464   1              while (time--)
 465   1              {
 466   2                      beep = ~beep;
 467   2                      Delay_ms(15);
 468   2              }
 469   1      }
 470          //ç”»å‡ºåœ°å›¾çš„ç­‰é«˜è¡¨
 471          void DrawHeightMap()
 472          {
 473   1              InitStack();
 474   1              InitMapFlag();
 475   1              num_StackNow = 0;//è®°å½•æ­£åœ¨æ£€æµ‹çš„é˜Ÿåˆ—çš„ä¸‹æ ‡
 476   1              num_Stack = 0;//num_Stackè®°å½•é˜Ÿåˆ—çš„é•¿åº¦ï¼Œå¹¶å°†åæ ‡(0ï¼Œ0)æ”¾å…¥é˜Ÿåˆ—
 477   1              stackX[0] = 7;
 478   1              stackY[0] = 7;
C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 9   

 479   1              mapFlag[0][0] = 1;//å°†èµ·ç‚¹çš„é«˜åº¦ç½®ä¸º1
 480   1              while (num_StackNow <= num_Stack)
 481   1              {
 482   2                      if (((map[stackX[num_StackNow]][stackY[num_StackNow]] % 16) | 0xf7 != 0xff) && (mapFlag[stackX[num_Stack
             -Now]][stackY[num_StackNow] + 1] != 0))//å¦‚æœæ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—ä¸Šæ–¹æ²¡æœ‰æŒ¡æ¿,ä¸”æœªè¿›å…¥è¿‡é˜Ÿåˆ—
 483   2                      {
 484   3                              num_Stack++;//å°†æ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—çš„ä¸Šæ–¹çš„æ–¹å—æ”¾å…¥é˜Ÿåˆ—
 485   3                              stackX[num_Stack] = stackX[num_StackNow];
 486   3                              stackY[num_Stack] = stackY[num_StackNow] + 1;
 487   3                              mapFlag[stackX[num_Stack]][stackY[num_Stack]] = mapFlag[stackX[num_StackNow]][stackY[num_StackNow]] + 1
             -;//å°†è¿™ä¸ªåœ°å›¾æ–¹å—çš„é«˜åº¦ç½®ä¸ºæ¯”æ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—çš„é«˜åº¦+1
 488   3      
 489   3                      }
 490   2                      if (((map[stackX[num_StackNow]][stackY[num_StackNow]] % 16) | 0xfb != 0xff) && (mapFlag[stackX[num_Stack
             -Now] + 1][stackY[num_StackNow]] != 0))//å¦‚æœæ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—å³æ–¹æ²¡æœ‰æŒ¡æ¿
 491   2                      {
 492   3                              num_Stack++;//å°†æ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—çš„å³æ–¹çš„æ–¹å—æ”¾å…¥é˜Ÿåˆ—
 493   3                              stackX[num_Stack] = stackX[num_StackNow] + 1;
 494   3                              stackY[num_Stack] = stackY[num_StackNow];
 495   3                              mapFlag[stackX[num_Stack]][stackY[num_Stack]] = mapFlag[stackX[num_StackNow]][stackY[num_StackNow]] + 1
             -;//å°†è¿™ä¸ªåœ°å›¾æ–¹å—çš„é«˜åº¦ç½®ä¸ºæ¯”æ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—çš„é«˜åº¦+1
 496   3      
 497   3                      }
 498   2                      if (((map[stackX[num_StackNow]][stackY[num_StackNow]] % 16) | 0xfd != 0xff) && (mapFlag[stackX[num_Stack
             -Now]][stackY[num_StackNow] - 1] != 0))//å¦‚æœæ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—åæ–¹æ²¡æœ‰æŒ¡æ¿
 499   2                      {
 500   3                              num_Stack++;//å°†æ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—çš„åæ–¹çš„æ–¹å—æ”¾å…¥é˜Ÿåˆ—
 501   3                              stackX[num_Stack] = stackX[num_StackNow];
 502   3                              stackY[num_Stack] = stackY[num_StackNow] - 1;
 503   3                              mapFlag[stackX[num_Stack]][stackY[num_Stack]] = mapFlag[stackX[num_StackNow]][stackY[num_StackNow]] + 1
             -;//å°†è¿™ä¸ªåœ°å›¾æ–¹å—çš„é«˜åº¦ç½®ä¸ºæ¯”æ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—çš„é«˜åº¦+1
 504   3      
 505   3                      }
 506   2                      if (((map[stackX[num_StackNow]][stackY[num_StackNow]] % 16) | 0xfe != 0xff) && (mapFlag[stackX[num_Stack
             -Now] - 1][stackY[num_StackNow]] != 0))//å¦‚æœæ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—å·¦æ–¹æ²¡æœ‰æŒ¡æ¿
 507   2                      {
 508   3                              num_Stack++;//å°†æ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—çš„å·¦æ–¹çš„æ–¹å—æ”¾å…¥é˜Ÿåˆ—
 509   3                              stackX[num_Stack] = stackX[num_StackNow] - 1;
 510   3                              stackY[num_Stack] = stackY[num_StackNow];
 511   3                              mapFlag[stackX[num_Stack]][stackY[num_Stack]] = mapFlag[stackX[num_StackNow]][stackY[num_StackNow]] + 1
             -;//å°†è¿™ä¸ªåœ°å›¾æ–¹å—çš„é«˜åº¦ç½®ä¸ºæ¯”æ­£åœ¨æ£€æµ‹çš„åœ°å›¾æ–¹å—çš„é«˜åº¦+1
 512   3      
 513   3                      }
 514   2                      num_StackNow++;
 515   2              }
 516   1      }
 517          //åˆ¶ä½œå†²åˆºè·¯çº¿
 518          void MakeRushMap()
 519          {
 520   1              InitStack();
 521   1              num_StackNow = 0;//å½“å‰åœ°å›¾æ–¹å—
 522   1              num_Stack = 0;//è·¯çº¿ä¸­çš„åœ°å›¾æ–¹å—çš„ä¸ªæ•°
 523   1              stackX[0] = 0;
 524   1              stackY[0] = 0;
 525   1              //æ‰¾åˆ°è·¯å¾„ä¸Šçš„æ‰€æœ‰åœ°å›¾æ–¹å—
 526   1              while (num_Stack < mapFlag[7][7])
 527   1              {
 528   2                      //æ£€æµ‹å½“å‰æ ˆä¸­çš„åœ°å›¾æ–¹å—ä¸Šæ–¹çš„åœ°å›¾æ–¹å—çš„é«˜åº¦ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æ»¡è¶³é€’å‡1çš„æ¡ä»
             -¶
 529   2                      if (mapFlag[stackX[num_StackNow]][stackY[num_StackNow]] - mapFlag[stackX[num_StackNow]][stackY[num_Stack
             -Now] + 1] == 1)
 530   2                      {
C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 10  

 531   3                              num_Stack++;
 532   3                              stackX[num_Stack] = stackX[num_Stack - 1];
 533   3                              stackY[num_Stack] = stackY[num_Stack - 1] + 1;
 534   3                              map[stackX[num_StackNow]][stackY[num_StackNow] + 1] |= 0xf0;//ç»™åœ°å›¾æ–¹å—çš„é«˜å››ä½é‡æ–°èµ‹å€¼
 535   3                              map[stackX[num_StackNow]][stackY[num_StackNow] + 1] &= 0x70;
 536   3                      }
 537   2                      //æ£€æµ‹å½“å‰æ ˆä¸­çš„åœ°å›¾æ–¹å—å³æ–¹çš„åœ°å›¾æ–¹å—çš„é«˜åº¦ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æ»¡è¶³é€’å‡1çš„æ¡ä»
             -¶
 538   2                      else if (mapFlag[stackX[num_StackNow]][stackY[num_StackNow]] - mapFlag[stackX[num_StackNow] + 1][stackY[
             -num_StackNow]] == 1)
 539   2                      {
 540   3                              num_Stack++;
 541   3                              stackX[num_Stack] = stackX[num_Stack - 1] + 1;
 542   3                              stackY[num_Stack] = stackY[num_Stack - 1];
 543   3                              map[stackX[num_StackNow]][stackY[num_StackNow] + 1] |= 0xf0;//ç»™åœ°å›¾æ–¹å—çš„é«˜å››ä½é‡æ–°èµ‹å€¼
 544   3                              map[stackX[num_StackNow]][stackY[num_StackNow] + 1] &= 0xb0;
 545   3                      }
 546   2                      //æ£€æµ‹å½“å‰æ ˆä¸­çš„åœ°å›¾æ–¹å—ä¸‹æ–¹çš„åœ°å›¾æ–¹å—çš„é«˜åº¦ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æ»¡è¶³é€’å‡1çš„æ¡ä»
             -¶
 547   2                      else if (mapFlag[stackX[num_StackNow]][stackY[num_StackNow]] - mapFlag[stackX[num_StackNow]][stackY[num_
             -StackNow] - 1] == 1)
 548   2                      {
 549   3                              num_Stack++;
 550   3                              stackX[num_Stack] = stackX[num_Stack - 1];
 551   3                              stackY[num_Stack] = stackY[num_Stack - 1] - 1;
 552   3                              map[stackX[num_StackNow]][stackY[num_StackNow] + 1] |= 0xf0;//ç»™åœ°å›¾æ–¹å—çš„é«˜å››ä½é‡æ–°èµ‹å€¼
 553   3                              map[stackX[num_StackNow]][stackY[num_StackNow] + 1] &= 0xd0;
 554   3                      }
 555   2                      //æ£€æµ‹å½“å‰æ ˆä¸­çš„åœ°å›¾æ–¹å—å·¦æ–¹çš„åœ°å›¾æ–¹å—çš„é«˜åº¦ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æ»¡è¶³é€’å‡1çš„æ¡ä»
             -¶
 556   2                      else if (mapFlag[stackX[num_StackNow]][stackY[num_StackNow]] - mapFlag[stackX[num_StackNow] - 1][stackY[
             -num_StackNow]] == 1)
 557   2                      {
 558   3                              num_Stack++;
 559   3                              stackX[num_Stack] = stackX[num_Stack - 1] - 1;
 560   3                              stackY[num_Stack] = stackY[num_Stack - 1];
 561   3                              map[stackX[num_StackNow]][stackY[num_StackNow] + 1] |= 0xf0;//ç»™åœ°å›¾æ–¹å—çš„é«˜å››ä½é‡æ–°èµ‹å€¼
 562   3                              map[stackX[num_StackNow]][stackY[num_StackNow] + 1] &= 0xe0;
 563   3                      }
 564   2              }
 565   1      }
 566          //å°è½¦çš„æœ€åå†²åˆº
 567          void CarRush()
 568          {
 569   1              while (!(Car.x == 0 && Car.y == 0))
 570   1              {
 571   2                      switch (map[Car.x][Car.y] / 16)
 572   2                      {
 573   3                              //å‡å¦‚è¿›æ¥æ—¶æœå‰,åˆ™å›å»æ—¶æœå
 574   3                      case 7:CarTurn_Dir = 2; break;
 575   3                              //å‡å¦‚è¿›æ¥æ—¶æœå³ï¼Œåˆ™å›å»æ—¶æœå·¦
 576   3                      case 11:CarTurn_Dir = 3; break;
 577   3                              //å‡å¦‚è¿›æ¥æ—¶æœåï¼Œåˆ™å›å»æ—¶æœå‰
 578   3                      case 13:CarTurn_Dir = 0; break;
 579   3                              //å‡å¦‚è¿›æ¥æ—¶æœå·¦ï¼Œåˆ™å›å»æ—¶æœå³
 580   3                      case 15:CarTurn_Dir = 1; break;
 581   3                      }
 582   2                      DriveCar(CarTurn_Dir);
 583   2              }
 584   1      }
 585          //è®¾ç½®T2è‡ªåŠ¨é‡è½½å¯„å­˜å™¨å’Œè®¡æ•°å™¨åˆå€¼
 586          void SetTime2(unsigned int us)
C51 COMPILER V9.55   CAR                                                                   12/16/2020 23:07:19 PAGE 11  

 587          {
 588   1              TH2 = (65536 - us) / 256;
 589   1              RCAP2H = (65536 - us) / 256;
 590   1              TL2 = (65536 - us) % 256;
 591   1              RCAP2L = (65536 - us) % 256;
 592   1      }
 593          //å®šæ—¶å™¨T2åˆå§‹åŒ–
 594          void InitTime2()
 595          {
 596   1              EA = 1;//æ€»ä¸­æ–­å…è®¸
 597   1              ET2 = 1;
 598   1              SetTime2(5000);
 599   1              TR2 = 1;
 600   1      }
 601          //T2ä¸­æ–­æœåŠ¡å‡½æ•°
 602          void time2() interrupt 5
 603          {
 604   1              ET2 = 0;
 605   1              SetTime2(5000);
 606   1              TF2 = 0;//æ¸…é™¤T2ä¸­æ–­æ ‡å¿—ä½
 607   1              if (!ir)//è®¾ç½®num_Gæ–¹å‘å‘å…‰äºŒæç®¡å‘å°„çº¢å¤–å…‰
 608   1                      MOUSE_IR_ON(num_G);
 609   1              else//æ£€æµ‹num_Gæ–¹å‘æ¥æ”¶ç®¡è¿”å›çš„ç”µå¹³
 610   1              {
 611   2                      switch (num_G)
 612   2                      {
 613   3                      case 0: {if (irR1) irC = 0; else irC = 1; }break;
 614   3                      case 1: {if (irR2) irLU = 0; else irLU = 1; }break;
 615   3                      case 2: {if (irR3) irL = 0; else irL = 1; }break;
 616   3                      case 3: {if (irR4) irR = 0; else irR = 1; }break;
 617   3                      case 4: {if (irR5) irRU = 0; else irRU = 1; }break;
 618   3                      }
 619   2              }
 620   1              if (ir)//å¦‚æœå®Œæˆäº†ä¸€æ¬¡å‘å°„å’Œæ¥æ”¶ï¼Œé‚£ä¹ˆå¼€å§‹æ£€æµ‹ä¸‹ä¸€ä¸ªLEDç®¡
 621   1                      num_G++;
 622   1              if (num_G == 5)//åå¤ä½æ£€æµ‹5ä¸ªçº¢å¤–LEDç¯ç®¡
 623   1                      num_G = 0;
 624   1              ir = ~ir;//æ”¹å˜æ¥æ”¶ã€å‘å°„çŠ¶æ€
 625   1              ET2 = 1;
 626   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5207    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =    268       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      6    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
